/*
* Kendo UI Complete v2012.1.322 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at http://kendoui.com/complete-license
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
(function(a,b){var c=kendo.mobile,d=kendo.fx,e=c.ui,f=a.proxy,g=a.extend,h=e.Widget,i=kendo.Class,j=kendo.ui.Movable,k=kendo.ui.Pane,l=kendo.ui.PaneDimensions,m=d.Transition,n=d.Animation,o=500,p=.7,q=.93,r=.5,s="km-scroller-release",t="km-scroller-refresh",u="pull",v="change",w=n.extend({init:function(a){var b=this;n.fn.init.call(b),g(b,a,{transition:new m({axis:a.axis,movable:a.movable,onEnd:function(){b._end()}})}),b.tap.bind("press",function(){b.cancel()}),b.drag.bind("end",f(b.start,b)),b.drag.bind("tap",f(b.onEnd,b))},onCancel:function(){this.transition.cancel()},freeze:function(a){var b=this;b.cancel(),b._moveTo(a)},onEnd:function(){var a=this;a._outOfBounds()?a._snapBack():a._end()},done:function(){return Math.abs(this.velocity)<1},start:function(){var a=this;!a.dimension.present()||(a._outOfBounds()?a._snapBack():(a.velocity=a.drag[a.axis].velocity*16,a.velocity&&(a.tap.captureNext(),n.fn.start.call(a))))},tick:function(){var a=this,b=a.dimension,c=a._outOfBounds()?r:q,d=a.velocity*=c,e=a.movable[a.axis]+d;!a.elastic&&b.outOfBounds(e)&&(e=Math.max(Math.min(e,b.max),b.min),a.velocity=0),a.movable.moveAxis(a.axis,e)},_end:function(){this.tap.cancelCapture(),this.end()},_outOfBounds:function(){return this.dimension.outOfBounds(this.movable[this.axis])},_snapBack:function(){var a=this,b=a.dimension,c=a.movable[a.axis]>b.max?b.max:b.min;a._moveTo(c)},_moveTo:function(a){this.transition.moveTo({location:a,duration:o,ease:m.easeOutExpo})}}),x=i.extend({init:function(b){var c=this,d=b.axis==="x",e=a('<div class="km-touch-scrollbar km-'+(d?"horizontal":"vertical")+'-scrollbar" />');g(c,b,{element:e,elementSize:0,movable:new j(e),scrollMovable:b.movable,size:d?"width":"height"}),c.scrollMovable.bind(v,f(c._move,c)),c.container.append(e)},_move:function(){var a=this,b=a.axis,c=a.dimension,d=c.size,e=a.scrollMovable,f=d/c.total,g=Math.round(-e[b]*f),h=Math.round(d*f);g+h>d?h=d-g:g<0&&(h+=g,g=0),a.elementSize!=h&&(a.element.css(a.size,h+"px"),a.elementSize=h),a.movable.moveAxis(b,g)},show:function(){this.element.css({opacity:p,visibility:"visible"})},hide:function(){this.element.css({opacity:0})}}),y=h.extend({init:function(a,b){var c=this;h.fn.init.call(c,a,b),a=c.element,a.css("overflow","hidden").addClass("km-scroll-wrapper").wrapInner('<div class="km-scroll-container"/>');var d=a.children().first(),e=new kendo.Tap(a),f=new j(d),i=new l({element:d,container:a}),m=new kendo.Drag(a,{allowSelection:!0,start:function(a){i.refresh(),m.capture()}}),n=new k({movable:f,dimensions:i,drag:m,elastic:c.options.elastic});g(c,{movable:f,dimensions:i,drag:m,pane:n,tap:e,pulled:!1,scrollElement:d}),c._initAxis("x"),c._initAxis("y"),i.refresh(),c.options.pullToRefresh&&c._initPullToRefresh()},options:{name:"Scroller",pullOffset:140,elastic:!0,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing"},events:[u],setOptions:function(a){var b=this;h.fn.setOptions.call(b,a),a.pullToRefresh&&b._initPullToRefresh()},reset:function(){this.movable.moveTo({x:0,y:0})},pullHandled:function(){var a=this;a.refreshHint.removeClass(t),a.hintContainer.html(a.pullTemplate({})),a.yinertia.onEnd(),a.xinertia.onEnd()},_initPullToRefresh:function(){var a=this;a.pullTemplate=kendo.template(a.options.pullTemplate),a.releaseTemplate=kendo.template(a.options.releaseTemplate),a.refreshTemplate=kendo.template(a.options.refreshTemplate),a.scrollElement.prepend('<span class="km-scroller-pull"><span class="km-icon"></span><span class="km-template">'+a.pullTemplate({})+"</span></span>"),a.refreshHint=a.scrollElement.children().first(),a.hintContainer=a.refreshHint.children(".km-template"),a.pane.y.bind("change",f(a._paneChange,a)),a.drag.bind("end",f(a._dragEnd,a))},_dragEnd:function(){var a=this;!a.pulled||(a.pulled=!1,a.refreshHint.removeClass(s).addClass(t),a.hintContainer.html(a.refreshTemplate({})),a.trigger("pull"),a.yinertia.freeze(a.options.pullOffset/2))},_paneChange:function(){var a=this;a.movable.y/r>a.options.pullOffset?a.pulled||(a.pulled=!0,a.refreshHint.removeClass(t).addClass(s),a.hintContainer.html(a.releaseTemplate({}))):a.pulled&&(a.pulled=!1,a.refreshHint.removeClass(s),a.hintContainer.html(a.pullTemplate({})))},_initAxis:function(a){var b=this,c=b.movable,d=b.dimensions[a],e=b.tap,f=new x({axis:a,movable:c,dimension:d,container:b.element}),g=new w({axis:a,movable:c,tap:e,drag:b.drag,dimension:d,elastic:b.options.elastic,end:function(){f.hide()}});b[a+"inertia"]=g,b.pane[a].bind(v,function(){f.show()})}});e.plugin(y)})(jQuery)