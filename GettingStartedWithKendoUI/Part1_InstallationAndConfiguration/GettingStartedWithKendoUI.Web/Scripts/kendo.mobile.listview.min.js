/*
* Kendo UI Complete v2012.1.322 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at http://kendoui.com/complete-license
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
(function(a,b){function w(b,d){d=a(d);var e=d.parent(),f=d.add(e.children("[data-"+c.ns+"role=detailbutton]"));if(!e.contents().not(f)[0]){var g=e.data(c.ns+"icon"),h=a('<span class="km-icon"/>');d.addClass("km-listview-link").attr(c.attr("role"),"listview-link"),g&&(d.prepend(h),h.addClass("km-"+g))}}function v(b){if(!(b.which>1)){var d=a(b.currentTarget),e=a(b.target).closest("a"),f=b.originalEvent&&b.originalEvent.defaultPrevented;role=e.data(c.ns+"role")||"",e[0]&&!role.match(/button/)&&d.toggleClass("km-state-active",b.type===o&&!f)}}var c=window.kendo,d=c.mobile.ui,e=c.support,f=c.data.DataSource,g=d.Widget,h=".km-list > li",i=a.proxy,j="km-group-title",k='<div class="'+j+'"><span class="km-text"></span></div>',l=c.template('<li><div class="'+j+'">#= this.headerTemplate(data) #</div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),m='<div class="km-listview-wrapper" />',n="function",o=e.mousedown,p=e.mousemove,q=e.mousecancel,r=e.mouseup,s="active-state-timeout",t="click",u="requestStart",x=g.extend({init:function(a,b){var d=this;g.fn.init.call(d,a,b),b=d.options,d.element.on([o,r,p,q].join(" "),h,v).on(r,h,i(d._click,d)),d._dataSource(),b.dataSource?d.dataSource.fetch():d._style(),d.element.wrap(m),d.wrapper=d.element.parent(),c.notify(d,c.mobile.ui)},events:[t],options:{name:"ListView",type:"flat",template:"${data}",pullToRefresh:!1,appendOnRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",headerTemplate:'<span class="km-text">${value}</span>',pullOffset:140,style:""},setOptions:function(a){g.fn.setOptions.call(this,a)},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),a.fetch()},_dataSource:function(){var a=this;a.dataSource&&a._refreshHandler?a.dataSource.unbind("change",a._refreshHandler).unbind(u,a._showLoadingProxy):a._refreshHandler=i(a.refresh,a),a.dataSource=f.create(a.options.dataSource).bind("change",a._refreshHandler),a._showLoadingProxy&&!a.options.pullToRefresh&&a.dataSource.bind(u,a._showLoadingProxy)},viewInit:function(a){var b=this,c=b.options,d=b.dataSource,e=a.application;b.scroller=a.scroller,b._hideLoadingProxy=i(e.hideLoading,e),b._showLoadingProxy=i(e.showLoading,e),c.pullToRefresh||d.bind(u,b._showLoadingProxy),c.pullToRefresh&&b.scroller.setOptions({pullToRefresh:!0,pull:function(){d.read()},pullTemplate:c.pullTemplate,releaseTemplate:c.releaseTemplate,refreshTemplate:c.refreshTemplate})},refresh:function(){var a=this,b=a.dataSource,d=a.element,e,f=a.options.appendOnRefresh?"prepend":"html",g,h=b.view();this._templates(),a.trigger("dataBinding"),b.group()[0]?(a.options.type="group",g=c.render(a.groupTemplate,h)):g=c.render(a.template,h),a.element[f](g),a.options.pullToRefresh&&a.scroller.pullHandled(),c.mobile.init(a.element.children()),a._hideLoadingProxy&&a._hideLoadingProxy(),a.trigger("dataBound"),a._style()},_templates:function(){var b=this,d=b.options.template,e=b.options.headerTemplate,f="",g={},h={};b.dataSource.view()[0]instanceof c.data.ObservableObject&&(f=' data-uid="#=uid#"'),typeof d===n&&(g.template=d,d="#=this.template(data)#"),h.template=b.template=a.proxy(c.template("<li"+f+">"+d+"</li>"),g),typeof e===n&&(h._headerTemplate=e,e="#=this._headerTemplate(data)#"),h.headerTemplate=c.template(e),b.groupTemplate=a.proxy(l,h)},_click:function(b){if(!(b.which>1)){var d=this,e,f=a(b.currentTarget),g=a(b.target),h=g.closest("["+c.attr("name")+"]",f),i=f.attr(c.attr("uid"));i&&(e=d.dataSource.getByUid(i)),d.trigger(t,{target:g,item:f,dataItem:e,button:h.data("kendoMobileButton")})&&b.preventDefault()}},items:function(){return this.element.find(".km-list").andSelf().find(">li")},_style:function(){var b=this,c=b.options,d=c.type==="group",e=b.element,f=c.style==="inset";e.addClass("km-listview").toggleClass("km-list",!d).toggleClass("km-listinset",!d&&f).toggleClass("km-listgroup",d&&!f).toggleClass("km-listgroupinset",d&&f),d&&(e.children().children("ul").addClass("km-list"),e.find(">li").each(function(){var b=a(this).contents().first();!b.is("ul")&&!b.is("div."+j)&&b.wrap(k)})),b.items().find(">a").each(w),e.closest(".km-content").toggleClass("km-insetcontent",f)}});d.plugin(x)})(jQuery)