/*
* Kendo UI Beta v2012.2.621 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(a,b){function n(b,c){b.filters&&(b.filters=a.grep(b.filters,function(a){n(a,c);return a.filters?a.filters.length:a.field!=c}))}var c=window.kendo,d=c.ui,e="kendoNumericTextBox",f="kendoDatePicker",g=a.proxy,h="kendoPopup",i="Is equal to",j="Is not equal to",k=d.Widget,l='<div><div class="k-filter-help-text">#=messages.info#</div><label>#=messages.isTrue#<input type="radio" data-#=ns#bind="checked: filters[0].value" value="true" name="filters[0].value"/></label><label>#=messages.isFalse#<input type="radio" data-#=ns#bind="checked: filters[0].value" value="false" name="filters[0].value"/></label><button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div>',m='<div><div class="k-filter-help-text">#=messages.info#</div><select data-#=ns#bind="value: filters[0].operator" data-#=ns#role="dropdownlist">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select><input data-#=ns#bind="value:filters[0].value" class="k-textbox" type="text" data-#=ns#type="#=type#"/>#if(extra){#<select class="k-filter-and" data-#=ns#bind="value: logic" data-#=ns#role="dropdownlist"><option value="and">#=messages.and#</option><option value="or">#=messages.or#</option></select><select data-#=ns#bind="value: filters[1].operator" data-#=ns#role="dropdownlist">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select><input data-#=ns#bind="value: filters[1].value" class="k-textbox" type="text" data-#=ns#type="#=type#"/>#}#<button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div>',o=k.extend({init:function(b,d){var i=this,j="string",n,o,p;k.fn.init.call(i,b,d),p=d.operators||{},b=i.element,d=i.options,n=b.addClass("k-filterable").find(".k-grid-filter"),n[0]||(n=b.prepend('<a class="k-grid-filter" href="#"><span class="k-icon k-filter"/></a>').find(".k-grid-filter")),i._clickHandler=g(i._click,i),n.click(i._clickHandler),i.dataSource=d.dataSource.bind("change",g(i.refresh,i)),i.field=b.attr(c.attr("field")),i.model=i.dataSource.reader.model,i._parse=function(a){return a+""},i.model&&i.model.fields&&(o=i.model.fields[i.field],o&&(j=o.type||"string",i._parse=g(o.parse,o))),p=p[j]||d.operators[j],i.form=a('<form class="k-filter-menu k-group"/>'),i.form.html(c.template(j==="boolean"?l:m)({field:i.field,ns:c.ns,messages:d.messages,extra:d.extra,operators:p,type:j})),i.popup=i.form[h]({anchor:n,open:g(i._open,i)}).data(h),i.link=n,i.form.bind({submit:g(i._submit,i),reset:g(i._reset,i)}).find("["+c.attr("type")+"=number]").removeClass("k-textbox")[e]().end().find("["+c.attr("type")+"=date]").removeClass("k-textbox")[f](),i.refresh()},refresh:function(){var a=this,b=a.dataSource.filter()||{filters:[],logic:"and"};a.filterModel=c.observable({logic:"and",filters:[{field:a.field,operator:"eq",value:""},{field:a.field,operator:"eq",value:""}]}),c.bind(a.form,a.filterModel),a._bind(b)?a.link.addClass("k-state-active"):a.link.removeClass("k-state-active")},destroy:function(){c.unbind(this.form),this.form.remove(),this.form.removeData(h),this.link.unbind("click",this._clickHandler),this.element.removeData("kendoFilterMenu")},_bind:function(a){var b=this,c=a.filters,d,e,f=!1,g=0,h=b.filterModel,i,j;for(d=0,e=c.length;d<e;d++)j=c[d],j.field==b.field?(h.set("logic",a.logic),i=h.filters[g],i.set("value",b._parse(j.value)),i.set("operator",j.operator),g++,f=!0):j.filters&&(f=f||b._bind(j));return f},_merge:function(b){var c=this,d=b.logic||"and",e=b.filters,f,g=c.dataSource.filter()||{filters:[],logic:"and"},h,i;n(g,c.field),e=a.grep(e,function(a){return a.value!==""});for(h=0,i=e.length;h<i;h++)f=e[h],f.value=c._parse(f.value);e.length&&(g.filters.length?(b.filters=e,g.logic!=="and"&&(g.filters=[{logic:g.logic,filters:g.filters}],g.logic="and"),e.length>1?g.filters.push(b):g.filters.push(e[0])):(g.filters=e,g.logic=d));return g},filter:function(a){a=this._merge(a),a.filters.length&&this.dataSource.filter(a)},clear:function(){var b=this,c=b.dataSource.filter()||{filters:[]};c.filters=a.grep(c.filters,function(c){if(c.filters){c.filters=a.grep(c.filters,function(a){return a.field!=b.field});return c.filters.length}return c.field!=b.field}),c.filters.length||(c=null),b.dataSource.filter(c)},_submit:function(a){var b=this;a.preventDefault(),b.filter(b.filterModel.toJSON()),b.popup.close()},_reset:function(a){this.clear(),this.popup.close()},_click:function(a){a.preventDefault(),a.stopPropagation(),this.popup.toggle()},_open:function(){a(".k-filter-menu").not(this.form).each(function(){a(this).data(h).close()})},options:{name:"FilterMenu",extra:!0,type:"string",operators:{string:{eq:i,neq:j,startswith:"Starts with",contains:"Contains",doesnotcontain:"Does not contain",endswith:"Ends with"},number:{eq:i,neq:j,gte:"Is greater than or equal to",gt:"Is greater than",lte:"Is less than or equal to",lt:"Is less than"},date:{eq:i,neq:j,gte:"Is after or equal to",gt:"Is after",lte:"Is before or equal to",lt:"Is before"}},messages:{info:"Show items with value that:",isTrue:"is true",isFalse:"is false",filter:"Filter",clear:"Clear",and:"And",or:"Or"}}});d.plugin(o)})(jQuery);